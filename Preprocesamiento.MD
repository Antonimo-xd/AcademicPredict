# ğŸ”§ Preprocesamiento del Dataset - AcademicPredict

---

## ğŸ“ **DescripciÃ³n General**

El script `limpiar_dataset_DEFINITIVO.py` es una herramienta crÃ­tica que transforma el dataset crudo de MDPI en un formato limpio, legible y listo para importar en AcademicPredict.

**Autor:** Desarrollado por el equipo AcademicPredict  
**VersiÃ³n:** 2.0 (Corregida)  
**UbicaciÃ³n:** `scripts/limpiar_dataset_DEFINITIVO.py`

---

## ğŸ¯ **Â¿QuÃ© Hace el Script?**

### **Transformaciones Principales:**

| TransformaciÃ³n | Antes | DespuÃ©s |
|---------------|-------|---------|
| **Hashes** | `dni_hash: a8f3e2d9c1b4...` | `Id_Estudiante: Estudiante_1` |
| **Columnas** | `caca` | `Anio_Academico` |
| **CategÃ³ricos** | `abandono_hash: A` | `Estado_Abandono: Abandono` |
| **LMS** | `pft_events_2021_9` | `Eventos_LMS_2021_09` |
| **Decimales** | `14,5` | `14.5` (interno) |
| **Separador** | `;` | `;` (mantenido) |

---

## ğŸ“Š **EstadÃ­sticas de TransformaciÃ³n**

### **114 Columnas Renombradas:**

```
ANTES (ejemplo):          â†’  DESPUÃ‰S:
dni_hash                  â†’  Id_Estudiante
tit_hash                  â†’  Id_Carrera
caca                      â†’  Anio_Academico
estudios_p_hash           â†’  Nivel_Educativo_Padre
pft_events_2021_9         â†’  Eventos_LMS_2021_09
```

### **5 CategorÃ­as de Variables:**

1. **Identificadores** (5): Estudiante, Carrera, Asignatura, Campus, Grupo
2. **DemogrÃ¡ficas** (10): Nivel educativo, dedicaciÃ³n, desplazamiento
3. **AcadÃ©micas** (40): CrÃ©ditos matriculados/aprobados, notas, rendimiento
4. **LMS** (30): Eventos, visitas, dÃ­as activos, tareas
5. **Target** (1): Estado de abandono

---

## ğŸš€ **Uso del Script**

### **Requisitos Previos:**

```python
# LibrerÃ­as necesarias
pip install pandas numpy
```

### **Estructura de Archivos:**

```
proyecto/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ limpiar_dataset_DEFINITIVO.py
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                          # Datasets crudos aquÃ­
â”‚   â”‚   â”œâ”€â”€ dataset_2021_hash.csv
â”‚   â”‚   â””â”€â”€ dataset_2022_hash.csv
â”‚   â””â”€â”€ processed/                    # Datasets limpios aquÃ­ (generados)
â”‚       â”œâ”€â”€ dataset_2021_ultra_limpio.csv
â”‚       â”œâ”€â”€ dataset_2022_ultra_limpio.csv
â”‚       â”œâ”€â”€ mapeo_completo_2021.csv
â”‚       â””â”€â”€ mapeo_completo_2022.csv
```

### **EjecuciÃ³n:**

```bash
# 1. Navegar a la carpeta del script
cd scripts/

# 2. Ejecutar
python limpiar_dataset_DEFINITIVO.py
```

### **Salida Esperada:**

```
INICIANDO LIMPIEZA V2

======================================================================
PROCESANDO V2: dataset_2021_hash.csv
======================================================================

Procesando chunk 30...
Concatenando chunks...
Guardando dataset...
Generando mapeo...
FINALIZADO: dataset_2021_ultra_limpio.csv (152847 filas)

======================================================================
PROCESANDO V2: dataset_2022_hash.csv
======================================================================

Procesando chunk 25...
Concatenando chunks...
Guardando dataset...
Generando mapeo...
FINALIZADO: dataset_2022_ultra_limpio.csv (145623 filas)
```

---

## ğŸ” **Transformaciones Detalladas**

### **1. ConversiÃ³n de Hashes â†’ Etiquetas Legibles**

**Problema:** El dataset original usa hashes largos para proteger privacidad.

**Ejemplo:**
```
dni_hash: "a8f3e2d9c1b4567890abcdef1234567890abcdef"
```

**SoluciÃ³n:** Mapeo automÃ¡tico a etiquetas numÃ©ricas incrementales.

```python
def crear_etiqueta_legible(columna, valor, contador):
    prefijos = {
        'Id_Estudiante': 'Estudiante',
        'Id_Carrera': 'Carrera',
        'Id_Asignatura': 'Asignatura',
        'Campus': 'Campus',
        'Id_Grupo_Creditos': 'Grupo'
    }
    prefijo = prefijos.get(columna, 'ID')
    return f'{prefijo}_{contador}'
```

**Resultado:**
```
Id_Estudiante: "Estudiante_1"
Id_Estudiante: "Estudiante_2"
...
Id_Carrera: "Carrera_1"
Id_Asignatura: "Asignatura_1"
```

**Beneficios:**
- âœ… Mantiene privacidad (no revela identidades)
- âœ… Legible para humanos
- âœ… Relaciones preservadas (mismo hash â†’ mismo ID)
- âœ… Archivo de mapeo generado para trazabilidad

---

### **2. Renombrado de Columnas**

**Problema:** Nombres de columnas crÃ­pticos del dataset original.

#### **Ejemplos de Renombrado:**

| Original | Nuevo | CategorÃ­a |
|----------|-------|-----------|
| `caca` | `Anio_Academico` | Temporal |
| `anyo_ingreso` | `Anio_Ingreso_Universidad` | Ingreso |
| `nota10_hash` | `Nota_Selectividad_Base` | AcadÃ©mico |
| `estudios_p_hash` | `Nivel_Educativo_Padre` | SocioeconÃ³mico |
| `cred_mat1` | `Creditos_Matriculados_Anio_Carrera_1` | CrÃ©ditos |
| `pft_events` | `Eventos_LMS` | Digital |

**Total:** 114 columnas renombradas

---

### **3. TransformaciÃ³n de Valores CategÃ³ricos**

#### **A. Nivel Educativo (Padre/Madre):**

```python
MAPEO_ESTUDIOS = {
    'F': 'FormacionProfesional',
    'L': 'Licenciatura',
    'M': 'Master',
    'P': 'Primaria',
    'R': 'SinDatos',
    'T': 'TecnicoSuperior'
}
```

**Antes:** `estudios_p_hash: "L"`  
**DespuÃ©s:** `Nivel_Educativo_Padre: "Licenciatura"`

#### **B. Estado de Abandono:**

```python
MAPEO_ABANDONO = {
    'A': 'Abandono',
    'B': 'NoAbandono'
}
```

**Antes:** `abandono_hash: "A"`  
**DespuÃ©s:** `Estado_Abandono: "Abandono"`

#### **C. Tipo de Acceso:**

```python
MAPEO_TIPO_INGRESO = {
    'NAP': 'Selectividad',
    'NAI': 'AccesoInternacional',
    'NAE': 'AccesoExtranjero',
    'NAD': 'AccesoDirecto',
    'NRO': 'Reconocimiento',
    # ... 14 tipos en total
}
```

#### **D. DedicaciÃ³n de Estudios:**

```python
MAPEO_DEDICACION = {
    'TC': 'TiempoCompleto',
    'TP': 'TiempoParcial'
}
```

#### **E. Estudiante Desplazado:**

```python
MAPEO_DESPLAZADO = {
    'A': 'Desplazado',
    'B': 'NoDesplazado'
}
```

---

### **4. Renombrado de Columnas LMS (Digitales)**

**Problema:** Columnas de actividad digital con formato inconsistente.

**PatrÃ³n Original:**
```
pft_events_2021_9          # Eventos en septiembre 2021
pft_visits_2021_10         # Visitas en octubre 2021
pft_assigment_submissions_2021_11  # Tareas (typo en original)
pft_assignment_submissions_2021_12 # Tareas (correcto)
```

**TransformaciÃ³n Aplicada:**

```python
PATRON_RENOMBRADO_DIGITAL = {
    'pft_events': 'Eventos_LMS',
    'pft_visits': 'Visitas_LMS',
    'pft_days_logged': 'Dias_Acceso_LMS',
    'pft_assigment_submissions': 'Tareas_Entregadas_LMS',    # Typo corregido
    'pft_assignment_submissions': 'Tareas_Entregadas_LMS',   # Correcto
    'pft_test_submissions': 'Examenes_Enviados_LMS',
    'pft_total_minutes': 'Minutos_Totales_LMS',
    'resource_events': 'Eventos_Recursos_LMS',
    'n_resource_days': 'Dias_Acceso_Recursos_LMS',
    'n_wifi_days': 'Dias_Acceso_Wifi_Campus',
}
```

**Resultado:**
```
Eventos_LMS_2021_09
Visitas_LMS_2021_10
Tareas_Entregadas_LMS_2021_11
Tareas_Entregadas_LMS_2021_12  # Ambas versiones del typo â†’ mismo nombre
```

**CorrecciÃ³n CrÃ­tica:** Mes con dos dÃ­gitos (`09` en vez de `9`)

---

### **5. ConversiÃ³n de Tipos de Datos**

#### **A. Columnas Binarias â†’ Enteros:**

```python
columnas_binarias = [
    'Cerca_De_Finalizacion_Carrera',    # 0 o 1
    'Es_Segunda_Titulacion',             # 0 o 1
    'Es_Plan_Antiguo_Adaptado',          # 0 o 1
    'Tiene_Impagos_Matricula'            # 0 o 1
]
```

**Antes:** `"1,0"`, `"0.0"`, `"NA"`, `"nan"`  
**DespuÃ©s:** `1`, `0`, `0`, `0`

#### **B. Columnas LMS â†’ Enteros:**

```python
patrones_enteros = [
    'Dias_Acceso_LMS',           # DÃ­as (entero)
    'Examenes_Enviados_LMS',     # Cantidad (entero)
    'Eventos_LMS',               # Contador (entero)
    'Visitas_LMS',               # Contador (entero)
    'Tareas_Entregadas_LMS'      # Cantidad (entero)
]
```

#### **C. Fechas â†’ DateTime:**

```python
columnas_fecha = ['Fecha_Extraccion_Datos', 'baja_fecha']
```

**Formato:** ISO 8601 (`YYYY-MM-DD`)

#### **D. CrÃ©ditos â†’ Rellenar con 0:**

```python
# Todas las columnas que contengan "Creditos"
# NaN â†’ "0"
```

---

### **6. Formato de Salida (Europeo)**

**Importante:** El archivo de salida mantiene el formato europeo para compatibilidad con el importador de Django.

```python
dataset_completo.to_csv(
    archivo_salida, 
    sep=';',          # Separador: punto y coma
    decimal=',',      # Decimal: coma
    encoding='utf-8',
    quoting=1         # Comillas para strings
)
```

**Ejemplo de registro:**

```csv
Id_Estudiante;Id_Carrera;Anio_Academico;Nota_Selectividad_Base;Estado_Abandono
Estudiante_1;Carrera_1;2021;14,5;NoAbandono
Estudiante_2;Carrera_2;2021;12,3;Abandono
```

---

## ğŸ“‹ **Archivo de Mapeo Generado**

El script genera automÃ¡ticamente un archivo CSV con todos los mapeos aplicados.

**Estructura:**

| columna | tipo | original | nuevo |
|---------|------|----------|-------|
| Id_Estudiante | Hash | a8f3e2d9c1b4... | Estudiante_1 |
| Id_Carrera | Hash | b9g4f3e0d2c5... | Carrera_1 |
| Estudios | Cat | L | Licenciatura |
| Abandono | Cat | A | Abandono |

**Uso del mapeo:**
- âœ… Trazabilidad completa
- âœ… ReversiÃ³n si es necesaria
- âœ… DocumentaciÃ³n de transformaciones
- âœ… AuditorÃ­a de datos

---

## âš™ï¸ **ConfiguraciÃ³n del Script**

### **ParÃ¡metros Editables:**

```python
# Archivos de entrada
ARCHIVO_DATASET1 = 'dataset_2021_hash.csv'
ARCHIVO_DATASET2 = 'dataset_2022_hash.csv'

# Archivos de salida
SALIDA_DATASET1 = 'dataset_2021_ultra_limpio.csv'
SALIDA_DATASET2 = 'dataset_2022_ultra_limpio.csv'

# Archivos de mapeo
MAPEO_DATASET1 = 'mapeo_completo_2021.csv'
MAPEO_DATASET2 = 'mapeo_completo_2022.csv'

# TamaÃ±o de chunks para procesar archivos grandes
CHUNK_SIZE = 5000  # Filas por chunk
```

### **Modificar para Otros Datasets:**

Si tienes otros archivos o nombres diferentes:

```python
# Ejemplo: Un solo archivo
ARCHIVO_DATASET1 = 'mi_dataset.csv'
SALIDA_DATASET1 = 'mi_dataset_limpio.csv'
MAPEO_DATASET1 = 'mapeo_mi_dataset.csv'

# En main, comentar el segundo dataset:
if __name__ == "__main__":
    print("INICIANDO LIMPIEZA V2")
    procesar_dataset(ARCHIVO_DATASET1, SALIDA_DATASET1, MAPEO_DATASET1)
    # procesar_dataset(ARCHIVO_DATASET2, SALIDA_DATASET2, MAPEO_DATASET2)  # Comentado
```

---

## ğŸ› **SoluciÃ³n de Problemas**

### **Error: "FileNotFoundError"**

```
ERROR: No se encontrÃ³ dataset_2021_hash.csv
```

**SoluciÃ³n:**
- Verificar que los archivos CSV estÃ©n en la misma carpeta que el script
- O modificar las rutas en la configuraciÃ³n

### **Error: "UnicodeDecodeError"**

```
Error: 'utf-8' codec can't decode byte...
```

**SoluciÃ³n:**
```python
# Cambiar encoding en lÃ­nea 373:
pd.read_csv(archivo_entrada, sep=';', encoding='latin-1', ...)
```

### **Error: "MemoryError"**

```
MemoryError: Unable to allocate array
```

**SoluciÃ³n:**
```python
# Reducir tamaÃ±o de chunks
CHUNK_SIZE = 1000  # En vez de 5000
```

### **Advertencia: "SettingWithCopyWarning"**

```
SettingWithCopyWarning: A value is trying to be set on a copy...
```

**SoluciÃ³n:** Ya manejado con `.copy()` en el cÃ³digo. Si aparece, es seguro ignorarlo.

---

## ğŸ“Š **ValidaciÃ³n de Resultados**

### **DespuÃ©s de ejecutar el script:**

```python
import pandas as pd

# Cargar dataset limpio
df = pd.read_csv('dataset_2021_ultra_limpio.csv', sep=';', decimal=',')

# Verificar columnas
print("Columnas:", df.columns.tolist())

# Verificar IDs
print("\nPrimeros 5 estudiantes:")
print(df['Id_Estudiante'].head())
# DeberÃ­a mostrar: Estudiante_1, Estudiante_2, etc.

# Verificar transformaciones categÃ³ricas
print("\nValores de Estado_Abandono:")
print(df['Estado_Abandono'].value_counts())
# DeberÃ­a mostrar: NoAbandono, Abandono (no A, B)

# Verificar columnas LMS
cols_lms = [col for col in df.columns if 'LMS' in col]
print(f"\nColumnas LMS encontradas: {len(cols_lms)}")

# Verificar tamaÃ±o
print(f"\nRegistros: {len(df)}")
print(f"Columnas: {len(df.columns)}")
```

---

## ğŸ”„ **Flujo Completo de Datos**

```
1. Dataset MDPI (Crudo)
   â”œâ”€â”€ dataset_2021_hash.csv (300 MB)
   â””â”€â”€ dataset_2022_hash.csv (280 MB)
           â†“
2. Script de Limpieza
   â””â”€â”€ limpiar_dataset_DEFINITIVO.py
           â†“
3. Datasets Limpios
   â”œâ”€â”€ dataset_2021_ultra_limpio.csv
   â”œâ”€â”€ dataset_2022_ultra_limpio.csv
   â”œâ”€â”€ mapeo_completo_2021.csv
   â””â”€â”€ mapeo_completo_2022.csv
           â†“
4. Importador Django
   â””â”€â”€ import_service_universidad.py
           â†“
5. Base de Datos MySQL
   â””â”€â”€ academicpredict
```

---

## ğŸ“ **Checklist de Preprocesamiento**

Antes de importar a Django:

- [ ] âœ… Descargar dataset crudo de MDPI
- [ ] âœ… Colocar archivos en carpeta `data/raw/`
- [ ] âœ… Ejecutar `limpiar_dataset_DEFINITIVO.py`
- [ ] âœ… Verificar que se generaron 4 archivos
- [ ] âœ… Validar transformaciones con script de verificaciÃ³n
- [ ] âœ… Revisar archivo de mapeo
- [ ] âœ… Mover datasets limpios a `data/processed/`
- [ ] âœ… Proceder con importaciÃ³n a Django

---

## ğŸ“ **Notas TÃ©cnicas**

### **Â¿Por quÃ© Processing por Chunks?**

Los datasets son grandes (+150k filas Ã— 77 columnas). Cargar todo en memoria de una vez podrÃ­a causar:
- Uso excesivo de RAM (>2 GB)
- Lentitud en equipos con poca memoria
- Posibles crashes

**SoluciÃ³n:** Procesar 5000 filas a la vez.

### **Â¿Por quÃ© Mantener Formato Europeo?**

El importador de Django (`import_service_universidad.py`) estÃ¡ configurado para leer formato europeo:
- Separador: `;`
- Decimal: `,`

Cambiar el formato requerirÃ­a modificar el importador.

### **Â¿Por quÃ© Dos Archivos (2021 y 2022)?**

El dataset MDPI puede venir en mÃºltiples archivos por aÃ±o acadÃ©mico. El script procesa ambos y resetea los mapeos entre ellos para mantener IDs Ãºnicos por archivo.

---

## ğŸ™ **CrÃ©ditos**

- **Dataset Original:** MDPI - "University Student Dropout Dataset"
- **Script:** Equipo AcademicPredict (BastiÃ¡n Vega, Erin MuÃ±oz, SebastiÃ¡n Araya)
- **VersiÃ³n:** 2.0 (Correcciones aplicadas)

---

## ğŸ“ **Soporte**

Â¿Problemas con el preprocesamiento?

1. Revisar esta documentaciÃ³n
2. Verificar configuraciÃ³n de rutas
3. Consultar secciÃ³n de SoluciÃ³n de Problemas
4. Contactar al equipo: academicpredict@ejemplo.com

---

<div align="center">
  <strong>Script de Preprocesamiento v2.0</strong>
  <br>
  <em>114 columnas renombradas â€¢ 5 categorÃ­as transformadas â€¢ Formato legible</em>
</div>